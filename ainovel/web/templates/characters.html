{% extends "base.html" %}

{% block title %}{{ novel.title }} - è§’è‰²å¡{% endblock %}

{% block content %}
<div style="margin-bottom: 16px;">
    <a href="/novels/view/{{ novel.id }}" style="color: #3498db; text-decoration: none;">â† è¿”å›é¡¹ç›®è¯¦æƒ…</a>
</div>

<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center;">
        <h2>ğŸ­ è§’è‰²å¡ Â· {{ novel.title }}</h2>
        <span style="color: #7f8c8d; font-size: 13px;">å…± {{ characters|length }} ä¸ªè§’è‰²</span>
    </div>
</div>

<!-- æ–°å¢è§’è‰²è¡¨å• -->
<div class="card">
    <h3 style="margin-bottom: 14px; font-size: 15px;">æ–°å¢è§’è‰²</h3>
    <form method="post" action="/novels/{{ novel.id }}/characters/new">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
            <div>
                <label style="font-size: 13px; color: #555; display: block; margin-bottom: 4px;">è§’è‰²å <span style="color: #e74c3c;">*</span></label>
                <input type="text" name="name" placeholder="è¾“å…¥è§’è‰²åç§°" required style="width: 100%; box-sizing: border-box;">
            </div>
            <div>
                <label style="font-size: 13px; color: #555; display: block; margin-bottom: 4px;">MBTI äººæ ¼</label>
                <select name="mbti" style="width: 100%; box-sizing: border-box; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
                    <optgroup label="åˆ†æå®¶ï¼ˆNTï¼‰">
                        <option value="INTJ">INTJ - å»ºç­‘å¸ˆ</option>
                        <option value="INTP">INTP - é€»è¾‘å­¦å®¶</option>
                        <option value="ENTJ">ENTJ - æŒ‡æŒ¥å®˜</option>
                        <option value="ENTP">ENTP - è¾©è®ºå®¶</option>
                    </optgroup>
                    <optgroup label="å¤–äº¤å®¶ï¼ˆNFï¼‰">
                        <option value="INFJ">INFJ - æå€¡è€…</option>
                        <option value="INFP">INFP - è°ƒåœè€…</option>
                        <option value="ENFJ">ENFJ - ä¸»äººå…¬</option>
                        <option value="ENFP">ENFP - ç«é€‰è€…</option>
                    </optgroup>
                    <optgroup label="å®ˆæŠ¤è€…ï¼ˆSJï¼‰">
                        <option value="ISTJ">ISTJ - ç‰©æµå¸ˆ</option>
                        <option value="ISFJ">ISFJ - å®ˆå«è€…</option>
                        <option value="ESTJ">ESTJ - æ€»ç»ç†</option>
                        <option value="ESFJ">ESFJ - æ‰§æ”¿å®˜</option>
                    </optgroup>
                    <optgroup label="æ¢é™©å®¶ï¼ˆSPï¼‰">
                        <option value="ISTP">ISTP - é‰´èµå®¶</option>
                        <option value="ISFP">ISFP - æ¢é™©å®¶</option>
                        <option value="ESTP">ESTP - ä¼ä¸šå®¶</option>
                        <option value="ESFP">ESFP - è¡¨æ¼”è€…</option>
                    </optgroup>
                </select>
            </div>
        </div>
        <div style="margin-bottom: 12px;">
            <label style="font-size: 13px; color: #555; display: block; margin-bottom: 4px;">èƒŒæ™¯æ•…äº‹ <span style="color: #e74c3c;">*</span></label>
            <textarea name="background" placeholder="è¾“å…¥è§’è‰²èƒŒæ™¯æ•…äº‹..." required style="min-height: 80px;"></textarea>
        </div>
        <button type="submit" class="btn btn-success">æ–°å¢è§’è‰²</button>
    </form>
</div>

{% if not characters %}
<div class="card" style="text-align: center; color: #7f8c8d; padding: 40px;">
    <p>æš‚æ— è§’è‰²ï¼Œå¯åœ¨ä¸Šæ–¹è¡¨å•æ‰‹åŠ¨æ–°å¢ï¼Œæˆ–åœ¨æ­¥éª¤ 2 ä½¿ç”¨ AI è‡ªåŠ¨ç”Ÿæˆã€‚</p>
</div>
{% else %}
<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px;">
    {% for char in characters %}
    <div class="card" style="position: relative;">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
            <div>
                <h3 style="font-size: 18px; color: #2c3e50;">{{ char.name }}</h3>
                <span style="font-size: 12px; background: #3498db; color: white; padding: 2px 8px; border-radius: 10px;">{{ char.mbti.value }}</span>
            </div>
            <a href="/characters/{{ char.id }}/edit" class="btn" style="font-size: 12px; padding: 6px 12px;">ç¼–è¾‘</a>
        </div>

        {% if char.current_mood or char.current_status %}
        <div style="background: #f8f9fa; border-radius: 4px; padding: 10px; margin-bottom: 10px; font-size: 13px;">
            {% if char.current_mood %}
            <div><span style="color: #7f8c8d;">å¿ƒæƒ…ï¼š</span>{{ char.current_mood }}</div>
            {% endif %}
            {% if char.current_status %}
            <div style="margin-top: 4px;"><span style="color: #7f8c8d;">çŠ¶æ€ï¼š</span>{{ char.current_status }}</div>
            {% endif %}
        </div>
        {% endif %}

        {% if char.goals %}
        <div style="font-size: 13px; margin-bottom: 8px;">
            <span style="color: #7f8c8d;">ç›®æ ‡ï¼š</span>{{ char.goals }}
        </div>
        {% endif %}

        {% if char.catchphrases %}
        <div style="font-size: 13px; margin-bottom: 8px;">
            <span style="color: #7f8c8d;">å£å¤´ç¦…ï¼š</span>
            {% for phrase in char.catchphrases %}
            <span style="background: #ecf0f1; padding: 2px 6px; border-radius: 3px; margin-right: 4px;">ã€Œ{{ phrase }}ã€</span>
            {% endfor %}
        </div>
        {% endif %}

        <div style="font-size: 13px; color: #555; margin-top: 8px; border-top: 1px solid #eee; padding-top: 8px;">
            {{ char.background[:80] }}{% if char.background|length > 80 %}â€¦{% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}
{% endblock %}
